<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
	
<sqlMap namespace="com.neopad.infobee_car.buy">

	<typeAlias alias ="RequestParameter" type="com.neopad.infobee_car.common.RequestParameter"/>
	<typeAlias alias="buy" type="com.neopad.infobee_car.buy.model.Buy"/>
	
	<resultMap class="buy" id="buyResult">
		<result property="buyCarSeq" column="BUY_CAR_SEQ"/>
		<result property="buyCarUserSeq" column="BUY_CAR_USER_SEQ"/>
		<result property="buyCarRegNo" column="BUY_CAR_REG_NO"/>
		<result property="buyCarDealType" column="BUY_CAR_DEAL_TYPE"/>
		<result property="buyCarMdlOne" column="BUY_CAR_MDL1"/>
		<result property="buyCarMdlTwo" column="BUY_CAR_MDL2"/>
		<result property="buyCarMdlThree" column="BUY_CAR_MDL3"/>
		<result property="buyCarPriceOne" column="BUY_CAR_PRICE1"/>
		<result property="buyCarPriceTwo" column="BUY_CAR_PRICE2"/>
		<result property="buyCarOpenYmOne" column="BUY_CAR_OPEN_YM1"/>
		<result property="buyCarOpenYmTwo" column="BUY_CAR_OPEN_YM2"/>
		<result property="buyCarMileageOne" column="BUY_CAR_MILEAGE1"/>
		<result property="buyCarMileageTwo" column="BUY_CAR_MILEAGE2"/>
		<result property="buyCarTrsms" column="BUY_CAR_TRSMS"/>
		<result property="buyCarFuel" column="BUY_CAR_FUEL"/>
		<result property="buyCarColorOne" column="BUY_CAR_COLOR1"/>
		<result property="buyCarColorTwo" column="BUY_CAR_COLOR2"/>
		<result property="buyCarColorThree" column="BUY_CAR_COLOR3"/>
		<result property="buyCarUserName" column="BUY_CAR_USER_NAME"/>
		<result property="buyCarUserEmail" column="BUY_CAR_USER_EMAIL"/>
		<result property="buyCarUserPhone" column="BUY_CAR_USER_PHONE"/>
		<result property="buyCarUserZip" column="BUY_CAR_USER_ZIP"/>
		<result property="buyCarUserAddr" column="BUY_CAR_USER_ADDR"/>
		<result property="buyCarStep" column="BUY_CAR_STEP"/>
		<result property="buyCarMemo" column="BUY_CAR_MEMO"/>
		<result property="buyCarStateYn" column="BUY_CAR_STATE_YN"/>
		<result property="buyCarRegDate" column="BUY_CAR_REG_DATE"/>
		<result property="buyCarChgDate" column="BUY_CAR_CHG_DATE"/>
	</resultMap>
	
	<resultMap class="buy" id="buyListResult">
		<result property="rowNum" column = "ROWNUM"/>
		<result property="buyCarSeq" column="BUY_CAR_SEQ"/>
		<result property="buyCarUserSeq" column="BUY_CAR_USER_SEQ"/>
		<result property="buyCarRegNo" column="BUY_CAR_REG_NO"/>
		<result property="buyCarDealType" column="BUY_CAR_DEAL_TYPE"/>
		<result property="buyCarMdlOne" column="BUY_CAR_MDL1"/>
		<result property="buyCarMdlTwo" column="BUY_CAR_MDL2"/>
		<result property="buyCarMdlThree" column="BUY_CAR_MDL3"/>
		<result property="buyCarPriceOne" column="BUY_CAR_PRICE1"/>
		<result property="buyCarPriceTwo" column="BUY_CAR_PRICE2"/>
		<result property="buyCarOpenYmOne" column="BUY_CAR_OPEN_YM1"/>
		<result property="buyCarOpenYmTwo" column="BUY_CAR_OPEN_YM2"/>
		<result property="buyCarMileageOne" column="BUY_CAR_MILEAGE1"/>
		<result property="buyCarMileageTwo" column="BUY_CAR_MILEAGE2"/>
		<result property="buyCarTrsms" column="BUY_CAR_TRSMS"/>
		<result property="buyCarFuel" column="BUY_CAR_FUEL"/>
		<result property="buyCarColorOne" column="BUY_CAR_COLOR1"/>
		<result property="buyCarColorTwo" column="BUY_CAR_COLOR2"/>
		<result property="buyCarColorThree" column="BUY_CAR_COLOR3"/>
		<result property="buyCarUserName" column="BUY_CAR_USER_NAME"/>
		<result property="buyCarUserEmail" column="BUY_CAR_USER_EMAIL"/>
		<result property="buyCarUserPhone" column="BUY_CAR_USER_PHONE"/>
		<result property="buyCarUserZip" column="BUY_CAR_USER_ZIP"/>
		<result property="buyCarUserAddr" column="BUY_CAR_USER_ADDR"/>
		<result property="buyCarStep" column="BUY_CAR_STEP"/>
		<result property="buyCarMemo" column="BUY_CAR_MEMO"/>
		<result property="buyCarStateYn" column="BUY_CAR_STATE_YN"/>
		<result property="buyCarRegDate" column="BUY_CAR_REG_DATE"/>
		<result property="buyCarChgDate" column="BUY_CAR_CHG_DATE"/>
		<result property="matching" column="MATCHING"/>			
		<result property="newMatching" column="NEW_MATCHING"/>	
	</resultMap>
	
	<resultMap class="buy" id="buyMatchingListResult">
		<result property="rowNum" column = "ROWNUM"/>
		<result property="buyCarSeq" column="BUY_CAR_SEQ"/>
		<result property="buyCarUserSeq" column="BUY_CAR_USER_SEQ"/>
		<result property="buyCarRegNo" column="BUY_CAR_REG_NO"/>
		<result property="buyCarDealType" column="BUY_CAR_DEAL_TYPE"/>
		<result property="buyCarPriceOne" column="BUY_CAR_PRICE1"/>
		<result property="buyCarPriceTwo" column="BUY_CAR_PRICE2"/>
		<result property="buyCarOpenYmOne" column="BUY_CAR_OPEN_YM1"/>
		<result property="buyCarOpenYmTwo" column="BUY_CAR_OPEN_YM2"/>
		<result property="buyCarMileageOne" column="BUY_CAR_MILEAGE1"/>
		<result property="buyCarMileageTwo" column="BUY_CAR_MILEAGE2"/>
		<result property="buyCarTrsms" column="BUY_CAR_TRSMS"/>
		<result property="buyCarFuel" column="BUY_CAR_FUEL"/>
		<result property="buyCarColorOne" column="BUY_CAR_COLOR1"/>
		<result property="buyCarColorTwo" column="BUY_CAR_COLOR2"/>
		<result property="buyCarColorThree" column="BUY_CAR_COLOR3"/>
		<result property="buyCarUserName" column="BUY_CAR_USER_NAME"/>
		<result property="buyCarUserEmail" column="BUY_CAR_USER_EMAIL"/>
		<result property="buyCarUserPhone" column="BUY_CAR_USER_PHONE"/>
		<result property="buyCarUserZip" column="BUY_CAR_USER_ZIP"/>
		<result property="buyCarUserAddr" column="BUY_CAR_USER_ADDR"/>
		<result property="buyCarStep" column="BUY_CAR_STEP"/>
		<result property="buyCarMemo" column="BUY_CAR_MEMO"/>
		<result property="buyCarStateYn" column="BUY_CAR_STATE_YN"/>
		<result property="buyCarRegDate" column="BUY_CAR_REG_DATE"/>
		<result property="buyCarChgDate" column="BUY_CAR_CHG_DATE"/>
		<result property="matching" column="MATCHING"/>			
		<result property="grdKor" column="GRD_KOR"/>	
		<result property="newMatching" column="NEW_MATCHING"/>
	</resultMap>
	
	<insert id="infomationInput" parameterClass="RequestParameter">
		INSERT INTO TBL_008_BUY_CAR(
			BUY_CAR_USER_SEQ,
			BUY_CAR_REG_NO,
			BUY_CAR_DEAL_TYPE,
			BUY_CAR_MDL1,
			BUY_CAR_MDL2,
			BUY_CAR_MDL3,
			BUY_CAR_PRICE1,
			BUY_CAR_PRICE2,
			BUY_CAR_OPEN_YM1,
			BUY_CAR_OPEN_YM2,
			BUY_CAR_MILEAGE1,
			BUY_CAR_MILEAGE2,
			BUY_CAR_TRSMS,
			BUY_CAR_FUEL,
			BUY_CAR_COLOR1,
			BUY_CAR_COLOR2,
			BUY_CAR_COLOR3,
			BUY_CAR_USER_NAME,
			BUY_CAR_USER_EMAIL,
			BUY_CAR_USER_PHONE,
			BUY_CAR_USER_ZIP,
			BUY_CAR_USER_ADDR,
			BUY_CAR_STEP,
			BUY_CAR_REG_DATE,
			BUY_CAR_CHG_DATE,
			BUY_CAR_MEMO,
			BUY_CAR_STATE_YN)
		VALUE(
			#buyCarUserSeq#,
			#buyCarRegNo#,
			#buyCarDealType#,
			#buyCarMdlOne#,
			#buyCarMdlTwo#,
			#buyCarMdlThree#,
			#buyCarPriceOne#,
			#buyCarPriceTwo#,
			#buyCarOpenYmOne#,
			#buyCarOpenYmTwo#,
			#buyCarMileageOne#,
			#buyCarMileageTwo#,
			#buyCarTrsms#,
			#buyCarFuel#,
			#buyCarColorOne#,
			#buyCarColorTwo#,
			#buyCarColorThree#,
			#buyCarUserName#,
			#buyCarUserEmail#,
			#buyCarUserPhone#,
			#buyCarUserZip#,
			#buyCarUserAddr#,
			'1',
			now(),
			now(),
			' ',
			'n')
	</insert>
	
	<select id="selectRegNumber" resultClass="int" parameterClass="String">
		SELECT COUNT(TS.BUY_CAR_SEQ) FROM TBL_008_BUY_CAR TS WHERE TS.BUY_CAR_REG_NO = #strSequance#
	</select>
	
	<!-- 입력창 완료 ~ 정보 가져오기 -->
	<select id="selectAllInfo" parameterClass="RequestParameter" resultMap="buyResult">
		SELECT * 
		FROM TBL_008_BUY_CAR
		WHERE BUY_CAR_SEQ = #buyCarSeq#
	</select>
	
	<!-- 희망 자동차 ~ 정보 가져오기 -->
	<select id="selectAllInfoList" parameterClass="RequestParameter" resultMap="buyResult">
		SELECT * 
		FROM TBL_008_BUY_CAR
		WHERE BUY_CAR_USER_SEQ = #buyCarUserSeq#
			AND BUY_CAR_STEP != '4'
		ORDER BY BUY_CAR_SEQ DESC
	</select>
	
	<select id="selectComparison" parameterClass="RequestParameter" resultClass="RequestParameter">
	<![CDATA[
	SELECT 
	BC.BUY_CAR_USER_NAME,
	SC.SELL_CAR_USER_NAME,
	BC.BUY_CAR_DEAL_TYPE,
	SC.SELL_CAR_DEAL_TYPE,
	BC.BUY_CAR_PRICE1,
	BC.BUY_CAR_PRICE2,
	SC.SELL_CAR_PRICE,
	(
		CONCAT(
		(SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE), 
		'/',
		(SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE),
		'/',
		(SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE),
		'/',
		(SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE)
		)
	)AS BUY_CAR_MDL1,
	(
		CONCAT(
		(SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE), 
		'/',
		(SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE),
		'/',
		(SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE),
		'/',
		(SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE)
		)
	)AS BUY_CAR_MDL2,
	(
		CONCAT(
		(SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE), 
		'/',
		(SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE),
		'/',
		(SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE),
		'/',
		(SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE)
		)
	)AS BUY_CAR_MDL3,
	(
		SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE SC.SELL_CAR_COMP = CC.CODE
	)AS SELL_CAR_COMP,
	(
		SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE SC.SELL_CAR_MDL = CC.CODE
	)AS SELL_CAR_MDL,
	(
		SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE SC.SELL_CAR_GRD = CC.CODE
	)AS SELL_CAR_GRD,
	(
		SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE SC.SELL_CAR_DTL_GRD = CC.CODE
	)AS SELL_CAR_DTL_GRD,
	BC.BUY_CAR_OPEN_YM1,
	BC.BUY_CAR_OPEN_YM2,
	SC.SELL_CAR_OPEN_YM,
	(
		SELECT C.VALUE1 FROM tbl_008_code C WHERE BC.BUY_CAR_COLOR1 = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_COLOR'
	)AS BUY_CAR_COLOR1,
	(
		SELECT C.VALUE1 FROM tbl_008_code C WHERE BC.BUY_CAR_COLOR2 = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_COLOR'
	)AS BUY_CAR_COLOR2,
	(
		SELECT C.VALUE1 FROM tbl_008_code C WHERE BC.BUY_CAR_COLOR3 = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_COLOR'
	)AS BUY_CAR_COLOR3,
	(
		SELECT C.VALUE1 FROM tbl_008_code C WHERE SC.SELL_CAR_COLOR = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_COLOR'
	)AS SELL_CAR_COLOR,
	(
		SELECT C.VALUE1 FROM tbl_008_code C WHERE BC.BUY_CAR_TRSMS = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_GEARSHIFT'
	)AS BUY_CAR_TRSMS,
	(
		SELECT C.VALUE1 FROM tbl_008_code C WHERE SC.SELL_CAR_TRSMS = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_GEARSHIFT'
	)AS SELL_CAR_TRSMS,
	BC.BUY_CAR_MILEAGE1,
	BC.BUY_CAR_MILEAGE2,
	SC.SELL_CAR_MILEAGE,
	(
		SELECT C.VALUE1 FROM tbl_008_code C WHERE BC.BUY_CAR_FUEL = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_FUEL'
	)AS BUY_CAR_FUEL,
	(
		SELECT C.VALUE1 FROM tbl_008_code C WHERE SC.SELL_CAR_FUEL = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_FUEL'
	)AS SELL_CAR_FUEL,
	(
	SELECT 
		50
		+ ((CASE WHEN BC.BUY_CAR_DEAL_TYPE = '3' THEN 1 WHEN BC.BUY_CAR_DEAL_TYPE = SC.SELL_CAR_DEAL_TYPE THEN 1 ELSE 0 END
		+ CASE WHEN BC.BUY_CAR_PRICE1 <= SC.SELL_CAR_PRICE AND BC.BUY_CAR_PRICE2 >= SC.SELL_CAR_PRICE THEN 1 ELSE 0 END
		+ CASE WHEN BC.BUY_CAR_MDL1 = " " AND BC.BUY_CAR_MDL2 = " " AND BC.BUY_CAR_MDL3 = " " THEN 2 WHEN BC.BUY_CAR_MDL1 = SC.SELL_CAR_DTL_GRD OR BC.BUY_CAR_MDL2 = SC.SELL_CAR_DTL_GRD OR BC.BUY_CAR_MDL3 = SC.SELL_CAR_DTL_GRD THEN 2 WHEN BC.BUY_CAR_MDL1 = SC.SELL_CAR_GRD OR BC.BUY_CAR_MDL3 = SC.SELL_CAR_GRD OR BC.BUY_CAR_MDL3 = SC.SELL_CAR_GRD THEN 1 ELSE 0 END
		+ CASE WHEN (BC.BUY_CAR_OPEN_YM1="" AND BC.BUY_CAR_OPEN_YM2 ="") OR (BC.BUY_CAR_OPEN_YM1 <= SC.SELL_CAR_OPEN_YM AND BC.BUY_CAR_OPEN_YM2 >= SC.SELL_CAR_OPEN_YM) THEN 1 ELSE 0 END
		+ CASE WHEN (BC.BUY_CAR_COLOR1 IS NULL AND BC.BUY_CAR_COLOR2 IS NULL AND BC.BUY_CAR_COLOR3 IS NULL) OR (BC.BUY_CAR_COLOR1 = SC.SELL_CAR_COLOR OR BC.BUY_CAR_COLOR2 = SC.SELL_CAR_COLOR OR BC.BUY_CAR_COLOR3 = SC.SELL_CAR_COLOR) THEN 1 ELSE 0 END
		+ CASE WHEN BC.BUY_CAR_TRSMS = SC.SELL_CAR_TRSMS THEN 1 ELSE 0 END
		+ CASE WHEN (BC.BUY_CAR_MILEAGE1 = 0 AND BC.BUY_CAR_MILEAGE2 = 0) OR (BC.BUY_CAR_MILEAGE1 <= SC.SELL_CAR_MILEAGE AND BC.BUY_CAR_MILEAGE2 >= SC.SELL_CAR_MILEAGE) THEN 1 ELSE 0 END
		+ CASE WHEN BC.BUY_CAR_FUEL = SC.SELL_CAR_FUEL THEN 1 ELSE 0 END) * 50 / 9)
	)AS PERCENT
	FROM tbl_008_buy_car BC, tbl_008_sell_car SC
	WHERE BC.BUY_CAR_SEQ = #buyCarSeq#
	AND SC.SELL_CAR_SEQ = #sellCarSeq#
	]]>
	</select>
	
	<select id="getListByUserSeq" resultMap="buyListResult" parameterClass="RequestParameter">
		SELECT
			(SELECT @RNUM := @RNUM - 1) AS ROWNUM,
			IFNULL(BUY_CAR_SEQ, 0) AS BUY_CAR_SEQ,
			IFNULL(BUY_CAR_USER_SEQ, 0) AS BUY_CAR_USER_SEQ,
			BUY_CAR_REG_NO,
			BUY_CAR_DEAL_TYPE,
			CONCAT(
				(SELECT VALUE3 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL1),
				'/',
				(SELECT VALUE4 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL1)
			)AS BUY_CAR_MDL1,
			CONCAT(
				(SELECT VALUE3 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL2), 
				'/',
				(SELECT VALUE4 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL2)
			)AS BUY_CAR_MDL2,
			CONCAT(
				(SELECT VALUE3 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL3), 
				'/',
				(SELECT VALUE4 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL3)
			)AS BUY_CAR_MDL3,
			IFNULL(BUY_CAR_PRICE1, 0) AS BUY_CAR_PRICE1,
			IFNULL(BUY_CAR_PRICE2, 0) AS BUY_CAR_PRICE2,
			BUY_CAR_OPEN_YM1,
			BUY_CAR_OPEN_YM2,
			IFNULL(BUY_CAR_MILEAGE1, 0) AS BUY_CAR_MILEAGE1,
			IFNULL(BUY_CAR_MILEAGE2, 0) AS BUY_CAR_MILEAGE2,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD
			WHERE CD.CODE_CATEGORY = 'CD_CAR_GEARSHIFT' 
			AND CD.CODE_KEY = BC.BUY_CAR_TRSMS)
			AS BUY_CAR_TRSMS,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD
			WHERE CD.CODE_CATEGORY = 'CD_CAR_FUEL' 
			AND CD.CODE_KEY = BC.BUY_CAR_FUEL) 
			AS BUY_CAR_FUEL,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD 
			WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
			AND CD.CODE_KEY = BC.BUY_CAR_COLOR1) 
			AS BUY_CAR_COLOR1,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD 
			WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
			AND CD.CODE_KEY = BC.BUY_CAR_COLOR2) 
			AS BUY_CAR_COLOR2,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD 
			WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
			AND CD.CODE_KEY = BC.BUY_CAR_COLOR3) 
			AS BUY_CAR_COLOR3,
			BUY_CAR_USER_NAME,
			BUY_CAR_USER_EMAIL,
			BUY_CAR_USER_PHONE,
			BUY_CAR_USER_ZIP,
			BUY_CAR_USER_ADDR,
			BUY_CAR_STEP,
			DATE_FORMAT(BUY_CAR_REG_DATE, '%y/%m/%d') AS BUY_CAR_REG_DATE,
			BUY_CAR_CHG_DATE,
			BUY_CAR_MEMO,
			BUY_CAR_STATE_YN,
			(SELECT COUNT(*) FROM
			 (SELECT * FROM TBL_008_SELL_CAR) AS SC
			WHERE SC.SELL_CAR_STEP != 4
			AND SC.SELL_CAR_STEP != 3 
			
			AND(
			BC.BUY_CAR_MDL1 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR BC.BUY_CAR_MDL2 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR BC.BUY_CAR_MDL3 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR 'OK' = 
			CASE
			WHEN BC.BUY_CAR_MDL1 = " " AND BC.BUY_CAR_MDL2 = " " AND BC.BUY_CAR_MDL3 = " "
			THEN 'OK'
			ELSE 'NO'
			END
			
			))AS MATCHING,
			(SELECT COUNT(*) -
			(
			SELECT COUNT(*) FROM TBL_008_TRANSACTION_PROGRESS WHERE TRANS_BUY_CAR_SEQ = BC.BUY_CAR_SEQ AND TRANS_DEAL_MAIN='B'
			)
			FROM
			 (SELECT * FROM TBL_008_SELL_CAR) AS SC
			WHERE SC.SELL_CAR_STEP != 4 AND SC.SELL_CAR_STEP != 3
			AND
			(BC.BUY_CAR_MDL1 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR BC.BUY_CAR_MDL2 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR BC.BUY_CAR_MDL3 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR 'OK' = 
			CASE
			WHEN BC.BUY_CAR_MDL1 = " " AND BC.BUY_CAR_MDL2 = " " AND BC.BUY_CAR_MDL3 = " "
			THEN 'OK'
			ELSE 'NO'
			END)
			)AS NEW_MATCHING
		FROM TBL_008_BUY_CAR BC, ( SELECT @RNUM := #outputNum# ) R
		WHERE BUY_CAR_USER_SEQ = #buyCarUserSeq#
		AND BUY_CAR_STEP != 4
		AND BUY_CAR_STEP != 3
		ORDER BY BUY_CAR_SEQ DESC
		LIMIT #startCount#, 10
	</select>
	
	<select id="selectGetRowCount" resultClass="int" parameterClass="RequestParameter">
			SELECT COUNT(*) FROM TBL_008_BUY_CAR WHERE BUY_CAR_USER_SEQ = #buyCarUserSeq# AND BUY_CAR_STEP != 4 AND BUY_CAR_STEP != 3
	</select>
	
	<select id="selectGetRowCount2" resultClass="int" parameterClass="RequestParameter">
			SELECT COUNT(*) FROM TBL_008_TRANSACTION_PROGRESS TP, TBL_008_BUY_CAR BC, TBL_008_SELL_CAR SC
				WHERE BC.BUY_CAR_SEQ = TP.TRANS_BUY_CAR_SEQ 
				AND SC.SELL_CAR_SEQ = TP.TRANS_SELL_CAR_SEQ
				AND BUY_CAR_USER_SEQ = #buyCarUserSeq#
				AND BUY_CAR_SEQ = #buyCarSeq#
				AND SC.SELL_CAR_STEP != 4
				AND SC.SELL_CAR_STEP != 3
	</select>
	
	<select id="getListFromSeqss" parameterClass="RequestParameter" resultClass="java.util.HashMap">
	<![CDATA[
	SELECT
	(SELECT @RNUM := @RNUM - 1) AS ROWNUM,
	BC.BUY_CAR_SEQ,
	IFNULL(SELL_CAR_SEQ, 0)
	AS SELL_CAR_SEQ,
	IFNULL(SELL_CAR_USER_SEQ, 0) AS SELL_CAR_USER_SEQ,
	SELL_CAR_REG_NO,
	SELL_CAR_DEAL_TYPE,
	IFNULL(SELL_CAR_PRICE, 0) AS
	SELL_CAR_PRICE,
	(SELECT DISTINCT(VALUE1)
	FROM TBL_008_CAR_CODE CC
	WHERE
	CC.CODE = SC.SELL_CAR_COMP
	) AS SELL_CAR_COMP,
	(SELECT DISTINCT(VALUE3)
	FROM TBL_008_CAR_CODE CC
	WHERE CC.CODE = SC.SELL_CAR_MDL
	) AS
	SELL_CAR_MDL,
	(SELECT DISTINCT(VALUE4)
	FROM TBL_008_CAR_CODE CC
	WHERE
	CC.CODE = SC.SELL_CAR_GRD
	) AS SELL_CAR_GRD,
	(SELECT DISTINCT(VALUE5)
	FROM TBL_008_CAR_CODE CC
	WHERE CC.CODE = SC.SELL_CAR_DTL_GRD
	) AS
	SELL_CAR_DTL_GRD,
	SELL_CAR_OPEN_YM,
	SELL_CAR_COLOR,
	(SELECT VALUE1
	FROM TBL_008_CODE CD
	WHERE CD.CODE_CATEGORY = 'CD_CAR_GEARSHIFT'
	AND CD.CODE_KEY = SC.SELL_CAR_TRSMS
	) AS SELL_CAR_TRSMS,
	SELL_CAR_DOOR_KND,
	SELL_CAR_MILEAGE,
	SELL_CAR_ENGINE_KND,
	IFNULL(SELL_CAR_CC, 0) AS SELL_CAR_CC,
	(SELECT
	VALUE1
	FROM TBL_008_CODE CD
	WHERE CD.CODE_CATEGORY = 'CD_CAR_FUEL'
	AND CD.CODE_KEY = SC.SELL_CAR_FUEL
	) AS SELL_CAR_FUEL,
	SELL_CAR_OPT_SAFE,
	SELL_CAR_OPT_CONV,
	SELL_CAR_OPT_AV,
	SELL_CAR_FEATURE,
	SELL_CAR_TRB_YN,
	SELL_CAR_TITLE,
	SELL_CAR_CONTENT,
	SELL_CAR_USER_NAME,
	SELL_CAR_USER_EMAIL,
	SELL_CAR_USER_PHONE,
	SELL_CAR_USER_COMP,
	SELL_CAR_USER_COMP_PHONE,
	SELL_CAR_USER_COMP_ADDR,
	SELL_CAR_USER_COMP_ADDR_DTL,
	SELL_CAR_USER_ZIP_CD,
	SELL_CAR_USER_ADDR_CD,
	SELL_CAR_STEP,
	SELL_CAR_MEMO,
	SELL_CAR_STATE_YN,
	DATE_FORMAT(SELL_CAR_REG_DATE, '%y/%m/%d') AS SELL_CAR_REG_DATE,
	SELL_CAR_CHG_DATE,
	(SELECT ATTACH_FILE_NAME FROM TBL_008_ATTACHFILE
	WHERE ATTACH_SELL_SEQ = SC.SELL_CAR_SEQ LIMIT 1) AS ATTACHFILE ,
	(SELECT COUNT(*) FROM
	(SELECT * FROM TBL_008_BUY_CAR) AS TEMP3
	WHERE SC.SELL_CAR_STEP != 4
	AND
	SC.SELL_CAR_STEP != 3
	AND(
	TEMP3.BUY_CAR_MDL1 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE
	SC.SELL_CAR_GRD
	END

	OR TEMP3.BUY_CAR_MDL2 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE
	SC.SELL_CAR_GRD
	END

	OR TEMP3.BUY_CAR_MDL3 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE
	SC.SELL_CAR_GRD
	END

	))AS MATCHING,

	(SELECT COUNT(*) -
	(
	SELECT COUNT(*) FROM TBL_008_TRANSACTION_PROGRESS WHERE
	TRANS_SELL_CAR_SEQ = SC.SELL_CAR_SEQ
	)
	FROM
	(SELECT * FROM TBL_008_BUY_CAR) AS TEMP3
	WHERE SC.SELL_CAR_STEP != 4
	AND
	SC.SELL_CAR_STEP != 3

	AND(TEMP3.BUY_CAR_MDL1 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE
	SC.SELL_CAR_GRD
	END

	OR TEMP3.BUY_CAR_MDL2 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE
	SC.SELL_CAR_GRD
	END

	OR TEMP3.BUY_CAR_MDL3 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE
	SC.SELL_CAR_GRD
	END)
	)AS NEW_MATCHING,
	(
	SELECT 
	50
	+ ((CASE WHEN BC.BUY_CAR_DEAL_TYPE = '3' THEN 1 WHEN BC.BUY_CAR_DEAL_TYPE = SC.SELL_CAR_DEAL_TYPE THEN 1 ELSE 0 END
	+ CASE WHEN BC.BUY_CAR_PRICE1 <= SC.SELL_CAR_PRICE AND BC.BUY_CAR_PRICE2 >= SC.SELL_CAR_PRICE THEN 1 ELSE 0 END
	+ CASE WHEN BC.BUY_CAR_MDL1 = " " AND BC.BUY_CAR_MDL2 = " " AND BC.BUY_CAR_MDL3 = " " THEN 2 WHEN BC.BUY_CAR_MDL1 = SC.SELL_CAR_DTL_GRD OR BC.BUY_CAR_MDL2 = SC.SELL_CAR_DTL_GRD OR BC.BUY_CAR_MDL3 = SC.SELL_CAR_DTL_GRD THEN 2 WHEN BC.BUY_CAR_MDL1 = SC.SELL_CAR_GRD OR BC.BUY_CAR_MDL3 = SC.SELL_CAR_GRD OR BC.BUY_CAR_MDL3 = SC.SELL_CAR_GRD THEN 1 ELSE 0 END
	+ CASE WHEN (BC.BUY_CAR_OPEN_YM1="" AND BC.BUY_CAR_OPEN_YM2 ="") OR (BC.BUY_CAR_OPEN_YM1 <= SC.SELL_CAR_OPEN_YM AND BC.BUY_CAR_OPEN_YM2 >= SC.SELL_CAR_OPEN_YM) THEN 1 ELSE 0 END
	+ CASE WHEN (BC.BUY_CAR_COLOR1 IS NULL AND BC.BUY_CAR_COLOR2 IS NULL AND BC.BUY_CAR_COLOR3 IS NULL) OR (BC.BUY_CAR_COLOR1 = SC.SELL_CAR_COLOR OR BC.BUY_CAR_COLOR2 = SC.SELL_CAR_COLOR OR BC.BUY_CAR_COLOR3 = SC.SELL_CAR_COLOR) THEN 1 ELSE 0 END
	+ CASE WHEN BC.BUY_CAR_TRSMS = SC.SELL_CAR_TRSMS THEN 1 ELSE 0 END
	+ CASE WHEN (BC.BUY_CAR_MILEAGE1 = 0 AND BC.BUY_CAR_MILEAGE2 = 0) OR (BC.BUY_CAR_MILEAGE1 <= SC.SELL_CAR_MILEAGE AND BC.BUY_CAR_MILEAGE2 >= SC.SELL_CAR_MILEAGE) THEN 1 ELSE 0 END
	+ CASE WHEN BC.BUY_CAR_FUEL = SC.SELL_CAR_FUEL THEN 1 ELSE 0 END) * 50 / 9)
	)AS PERSENT
	FROM TBL_008_SELL_CAR SC,TBL_008_BUY_CAR BC, ( SELECT @RNUM := #outputNum#
	) R
	WHERE BUY_CAR_SEQ= #buyCarSeq#
	AND
	(BC.BUY_CAR_MDL1 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE SC.SELL_CAR_GRD
	END

	OR BC.BUY_CAR_MDL2 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE SC.SELL_CAR_GRD
	END

	OR BC.BUY_CAR_MDL3 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE SC.SELL_CAR_GRD
	END

	OR 'OK' =
	CASE
	WHEN BC.BUY_CAR_MDL1 = " " AND BC.BUY_CAR_MDL2 = " " AND BC.BUY_CAR_MDL3 =
	" "
	THEN 'OK'
	ELSE 'NO'
	END
	)AND SC.SELL_CAR_STEP != 4 AND SC.SELL_CAR_STEP != 3
	ORDER BY SELL_CAR_SEQ DESC
	LIMIT #startCount#, 10
	]]>
	</select>
	
	<select id="getListFromSeqs" parameterClass="RequestParameter" resultClass="java.util.HashMap">
	SELECT SELL_CAR_SEQ, BUY_CAR_SEQ FROM TBL_008_SELL_CAR SC,TBL_008_BUY_CAR BC
	WHERE BUY_CAR_SEQ=#buyCarSeq#
	AND
	(BC.BUY_CAR_MDL1 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE SC.SELL_CAR_GRD
	END

	OR BC.BUY_CAR_MDL2 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE SC.SELL_CAR_GRD
	END

	OR BC.BUY_CAR_MDL3 =
	CASE
	WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
	THEN SC.SELL_CAR_DTL_GRD
	ELSE SC.SELL_CAR_GRD
	END

	OR 'OK' =
	CASE
	WHEN BC.BUY_CAR_MDL1 = " " AND BC.BUY_CAR_MDL2 = " " AND BC.BUY_CAR_MDL3 = " "
	THEN 'OK'
	ELSE 'NO'
	END
	)AND SC.SELL_CAR_STEP != 4 AND SC.SELL_CAR_STEP != 3
	
	</select>
	
	<select id="getObjectByUserSeq" resultMap="buyListResult" parameterClass="RequestParameter">
		SELECT
			(SELECT @RNUM := @RNUM + 1) AS ROWNUM,
			IFNULL(BUY_CAR_SEQ, 0) AS BUY_CAR_SEQ,
			IFNULL(BUY_CAR_USER_SEQ, 0) AS BUY_CAR_USER_SEQ,
			BUY_CAR_REG_NO,
			BUY_CAR_DEAL_TYPE,
			CONCAT(
				(SELECT VALUE3 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL1),
				'/',
				(SELECT VALUE4 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL1)
			)AS BUY_CAR_MDL1,
			CONCAT(
				(SELECT VALUE3 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL2), 
				'/',
				(SELECT VALUE4 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL2)
			)AS BUY_CAR_MDL2,
			CONCAT(
				(SELECT VALUE3 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL3), 
				'/',
				(SELECT VALUE4 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL3)
			)AS BUY_CAR_MDL3,
			IFNULL(BUY_CAR_PRICE1, 0) AS BUY_CAR_PRICE1,
			IFNULL(BUY_CAR_PRICE2, 0) AS BUY_CAR_PRICE2,
			BUY_CAR_OPEN_YM1,
			BUY_CAR_OPEN_YM2,
			IFNULL(BUY_CAR_MILEAGE1, 0) AS BUY_CAR_MILEAGE1,
			IFNULL(BUY_CAR_MILEAGE2, 0) AS BUY_CAR_MILEAGE2,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD
			WHERE CD.CODE_CATEGORY = 'CD_CAR_GEARSHIFT' 
			AND CD.CODE_KEY = BC.BUY_CAR_TRSMS)
			AS BUY_CAR_TRSMS,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD
			WHERE CD.CODE_CATEGORY = 'CD_CAR_FUEL' 
			AND CD.CODE_KEY = BC.BUY_CAR_FUEL) 
			AS BUY_CAR_FUEL,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD 
			WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
			AND CD.CODE_KEY = BC.BUY_CAR_COLOR1) 
			AS BUY_CAR_COLOR1,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD 
			WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
			AND CD.CODE_KEY = BC.BUY_CAR_COLOR2) 
			AS BUY_CAR_COLOR2,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD 
			WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
			AND CD.CODE_KEY = BC.BUY_CAR_COLOR3) 
			AS BUY_CAR_COLOR3,
			BUY_CAR_USER_NAME,
			BUY_CAR_USER_EMAIL,
			BUY_CAR_USER_PHONE,
			BUY_CAR_USER_ZIP,
			BUY_CAR_USER_ADDR,
			BUY_CAR_STEP,
			DATE_FORMAT(BUY_CAR_REG_DATE, '%y/%m/%d') AS BUY_CAR_REG_DATE,
			BUY_CAR_CHG_DATE,
			BUY_CAR_MEMO,
			BUY_CAR_STATE_YN,
			(SELECT COUNT(*) FROM
			 (SELECT * FROM TBL_008_SELL_CAR) AS SC
			WHERE SC.SELL_CAR_STEP !=4
			AND SC.SELL_CAR_STEP !=3
			AND(
			BC.BUY_CAR_MDL1 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR BC.BUY_CAR_MDL2 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR BC.BUY_CAR_MDL3 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			))AS MATCHING,
			(SELECT COUNT(*) -
			(
			SELECT COUNT(*) FROM TBL_008_TRANSACTION_PROGRESS WHERE TRANS_BUY_CAR_SEQ = BC.BUY_CAR_SEQ
			)
			FROM
			 (SELECT * FROM TBL_008_SELL_CAR) AS SC
			WHERE SC.SELL_CAR_STEP !=4
			AND SC.SELL_CAR_STEP !=3 
			
			AND(BC.BUY_CAR_MDL1 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR BC.BUY_CAR_MDL2 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END
			
			OR BC.BUY_CAR_MDL3 = 
			CASE
			WHEN SC.SELL_CAR_DTL_GRD != 'NULL'
			THEN SC.SELL_CAR_DTL_GRD
			ELSE SC.SELL_CAR_GRD
			END)
			)AS NEW_MATCHING
		FROM TBL_008_BUY_CAR BC
		WHERE BUY_CAR_SEQ = #buyCarSeq#
		ORDER BY BUY_CAR_SEQ DESC
	</select>
	
	<update id="updateDelete" parameterClass="RequestParameter">
		UPDATE TBL_008_BUY_CAR
		SET
			BUY_CAR_STEP = 4
		WHERE BUY_CAR_REG_NO = #buyCarRegNo1#
			OR BUY_CAR_REG_NO = #buyCarRegNo2#
			OR BUY_CAR_REG_NO = #buyCarRegNo3#
			OR BUY_CAR_REG_NO = #buyCarRegNo4#
			OR BUY_CAR_REG_NO = #buyCarRegNo5#
			OR BUY_CAR_REG_NO = #buyCarRegNo6#
			OR BUY_CAR_REG_NO = #buyCarRegNo7#
			OR BUY_CAR_REG_NO = #buyCarRegNo8#
			OR BUY_CAR_REG_NO = #buyCarRegNo9#
			OR BUY_CAR_REG_NO = #buyCarRegNo10#
	</update>
	
	<update id="updateEnd" parameterClass="RequestParameter">
		UPDATE TBL_008_BUY_CAR
		SET
			BUY_CAR_STEP = 3
		WHERE BUY_CAR_REG_NO = #buyCarRegNo#
	</update>
	
	<select id="selectListByMatching" parameterClass="RequestParameter" resultMap="buyMatchingListResult">
<![CDATA[		
SELECT TEMP5.*, 50+TRUNCATE((
			+ ((SELECT CASE WHEN TEMP5.BUY_CAR_DEAL_TYPE = SC.SELL_CAR_DEAL_TYPE	OR TEMP5.BUY_CAR_DEAL_TYPE=3 THEN 10 ELSE 0	END)
			 + (SELECT CASE WHEN TEMP5.BUY_CAR_PRICE1 <= SC.SELL_CAR_PRICE AND TEMP5.BUY_CAR_PRICE2 >= SC.SELL_CAR_PRICE THEN 10	ELSE 0 END)
			 + (SELECT CASE WHEN TEMP5.GRD_KOR = SC.SELL_CAR_DTL_GRD OR TEMP5.GRD_KOR='차종전체' THEN 20 WHEN TEMP5.GRD_KOR = SC.SELL_CAR_GRD THEN 10	ELSE 0 END)
			 + (SELECT CASE WHEN (TEMP5.BUY_CAR_OPEN_YM1 <= SC.SELL_CAR_OPEN_YM AND TEMP5.BUY_CAR_OPEN_YM2 >= SC.SELL_CAR_OPEN_YM) OR (TEMP5.BUY_CAR_OPEN_YM1='') THEN 10 ELSE 0	END)
			 + (SELECT CASE WHEN BUY_CAR_COLOR1 = SC.SELL_CAR_COLOR OR BUY_CAR_COLOR2 = SC.SELL_CAR_COLOR OR BUY_CAR_COLOR3 = SC.SELL_CAR_COLOR OR BUY_CAR_COLOR1 IS NULL	THEN 10 ELSE 0	END 
			 					FROM TBL_008_BUY_CAR WHERE BUY_CAR_SEQ= TEMP5.BUY_CAR_SEQ)	
			 + (SELECT CASE WHEN BUY_CAR_TRSMS = SC.SELL_CAR_TRSMS THEN 10 ELSE 0 END 
			 					FROM TBL_008_BUY_CAR WHERE BUY_CAR_SEQ= TEMP5.BUY_CAR_SEQ)	
			 + (SELECT CASE WHEN (TEMP5.BUY_CAR_MILEAGE1 <= SC.SELL_CAR_MILEAGE AND TEMP5.BUY_CAR_MILEAGE2 >= SC.SELL_CAR_MILEAGE) OR (TEMP5.BUY_CAR_MILEAGE1=0) THEN 10 ELSE 0 END)																		
			 + (SELECT CASE WHEN BUY_CAR_FUEL = SC.SELL_CAR_FUEL THEN 10 ELSE 0 END 
			 					FROM TBL_008_BUY_CAR WHERE BUY_CAR_SEQ= TEMP5.BUY_CAR_SEQ)	) * 0.56),0) AS MATCHING,
			 (SELECT CASE WHEN TEMP5.GRD_KOR!='차종전체' THEN (SELECT CONCAT(VALUE1,'/',VALUE3,'/',VALUE4,'/',VALUE5) FROM TBL_008_CAR_CODE WHERE CODE=TEMP5.GRD_KOR) ELSE NULL END)AS NEW_MATCHING					

FROM (SELECT
			(SELECT @RNUM := @RNUM - 1) AS ROWNUM,
			IFNULL(BUY_CAR_SEQ, 0) AS BUY_CAR_SEQ,
			IFNULL(BUY_CAR_USER_SEQ, 0) AS BUY_CAR_USER_SEQ,
			BUY_CAR_REG_NO,
			BUY_CAR_DEAL_TYPE,
			(SELECT CASE 
				WHEN BUY_CAR_MDL1='' AND BUY_CAR_MDL2='' AND BUY_CAR_MDL3='' THEN '차종전체' 
				WHEN BUY_CAR_MDL1=(SELECT CASE 
												WHEN SELL_CAR_DTL_GRD!=NULL THEN SELL_CAR_DTL_GRD	ELSE SELL_CAR_GRD	END 
													FROM TBL_008_SELL_CAR WHERE SELL_CAR_SEQ=#sellCarSeq#)
				THEN BUY_CAR_MDL1 
				WHEN BUY_CAR_MDL2=(SELECT CASE 
												WHEN SELL_CAR_DTL_GRD!=NULL THEN SELL_CAR_DTL_GRD	ELSE SELL_CAR_GRD	END 
													FROM TBL_008_SELL_CAR WHERE SELL_CAR_SEQ=#sellCarSeq#)
				THEN BUY_CAR_MDL2 
				WHEN BUY_CAR_MDL3=(SELECT CASE 
												WHEN SELL_CAR_DTL_GRD!=NULL THEN SELL_CAR_DTL_GRD	ELSE SELL_CAR_GRD	END 
												   FROM TBL_008_SELL_CAR WHERE SELL_CAR_SEQ=#sellCarSeq#)
				THEN BUY_CAR_MDL3 END)AS GRD_KOR,
			IFNULL(BUY_CAR_PRICE1, 0) AS BUY_CAR_PRICE1,
			IFNULL(BUY_CAR_PRICE2, 0) AS BUY_CAR_PRICE2,
			BUY_CAR_OPEN_YM1,
			BUY_CAR_OPEN_YM2,
			IFNULL(BUY_CAR_MILEAGE1, 0) AS BUY_CAR_MILEAGE1,
			IFNULL(BUY_CAR_MILEAGE2, 0) AS BUY_CAR_MILEAGE2,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD
			WHERE CD.CODE_CATEGORY = 'CD_CAR_GEARSHIFT' 
			AND CD.CODE_KEY = BC.BUY_CAR_TRSMS)
			AS BUY_CAR_TRSMS,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD
			WHERE CD.CODE_CATEGORY = 'CD_CAR_FUEL' 
			AND CD.CODE_KEY = BC.BUY_CAR_FUEL) 
			AS BUY_CAR_FUEL,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD 
			WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
			AND CD.CODE_KEY = BC.BUY_CAR_COLOR1) 
			AS BUY_CAR_COLOR1,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD 
			WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
			AND CD.CODE_KEY = BC.BUY_CAR_COLOR2) 
			AS BUY_CAR_COLOR2,
			(SELECT VALUE1 
			FROM TBL_008_CODE CD 
			WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
			AND CD.CODE_KEY = BC.BUY_CAR_COLOR3) 
			AS BUY_CAR_COLOR3,
			BUY_CAR_USER_NAME,
			BUY_CAR_USER_EMAIL,
			BUY_CAR_USER_PHONE,
			BUY_CAR_USER_ZIP,
			BUY_CAR_USER_ADDR,
			BUY_CAR_STEP,
			DATE_FORMAT(BUY_CAR_REG_DATE, '%y/%m/%d') AS BUY_CAR_REG_DATE,
			BUY_CAR_CHG_DATE,
			BUY_CAR_MEMO,
			BUY_CAR_STATE_YN
			FROM TBL_008_BUY_CAR BC, ( SELECT @RNUM := (SELECT COUNT(*) FROM TBL_008_BUY_CAR WHERE BUY_CAR_SEQ IN (SELECT TRANS_BUY_CAR_SEQ FROM TBL_008_TRANSACTION_PROGRESS WHERE TRANS_SELL_CAR_SEQ = #sellCarSeq#
			AND TRANS_DEAL_MAIN='S'
			))) R 
			WHERE BUY_CAR_SEQ IN (
				SELECT TRANS_BUY_CAR_SEQ 
				FROM TBL_008_TRANSACTION_PROGRESS 
				WHERE TRANS_SELL_CAR_SEQ = #sellCarSeq#
				AND TRANS_DEAL_MAIN='S'
				AND TRANS_CONDITION='000'
			) 
			AND BC.BUY_CAR_STEP != 4
			AND BC.BUY_CAR_STEP != 3) TEMP5, TBL_008_SELL_CAR SC
			WHERE SELL_CAR_SEQ=#sellCarSeq#

			]]>
					
	</select>

	
	<!-- 입력창 완료 ~ 정보 가져오기 완성본 -->
	<select id="selectCompleteInfo" parameterClass="RequestParameter" resultClass="RequestParameter">
		SELECT
		BC.BUY_CAR_REG_DATE,
		BC.BUY_CAR_REG_NO,
		BC.BUY_CAR_DEAL_TYPE,
		(
			CONCAT(
			(SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE), 
			'/',
			(SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE),
			'/',
			(SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE),
			'/',
			(SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE)
			)
		)AS BUY_CAR_MDL1,
		(
			CONCAT(
			(SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE), 
			'/',
			(SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE),
			'/',
			(SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE),
			'/',
			(SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE)
			)
		)AS BUY_CAR_MDL2,
		(
			CONCAT(
			(SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE), 
			'/',
			(SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE),
			'/',
			(SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE),
			'/',
			(SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE)
			)
		)AS BUY_CAR_MDL3,
		BC.BUY_CAR_PRICE1,
		BC.BUY_CAR_PRICE2,
		BC.BUY_CAR_OPEN_YM1,
		BC.BUY_CAR_OPEN_YM2,
		BC.BUY_CAR_MILEAGE1,
		BC.BUY_CAR_MILEAGE2,
		(
			SELECT C.VALUE1 FROM tbl_008_code C WHERE BC.BUY_CAR_TRSMS = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_GEARSHIFT'
		)AS BUY_CAR_TRSMS,
		(
			SELECT C.VALUE1 FROM tbl_008_code C WHERE BC.BUY_CAR_FUEL = C.CODE_KEY AND C.CODE_CATEGORY = 'CD_CAR_FUEL'
		)AS BUY_CAR_FUEL,
		BC.BUY_CAR_COLOR1,
		BC.BUY_CAR_COLOR2,
		BC.BUY_CAR_COLOR3,
		BC.BUY_CAR_USER_NAME,
		BC.BUY_CAR_USER_EMAIL,
		BC.BUY_CAR_USER_PHONE,
		BC.BUY_CAR_USER_ZIP,
		BC.BUY_CAR_USER_ADDR
		FROM TBL_008_BUY_CAR BC
		WHERE BC.BUY_CAR_SEQ = #buyCarSeq#
		AND BC.BUY_CAR_USER_SEQ = #buyCarUserSeq#
	</select>
	
	<!-- 입력 수정 ~ 정보 가져오기 -->
	<select id="selectModifyInfo" parameterClass="RequestParameter" resultClass="RequestParameter">
		SELECT
		BC.BUY_CAR_REG_NO,
		BC.BUY_CAR_DEAL_TYPE,
		(
			CONCAT(
			(SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE), 
			'/',
			(SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE),
			'/',
			(SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE),
			'/',
			(SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL1 = CC.CODE)
			)
		)AS BUY_CAR_MDL1,
		(
			CONCAT(
			(SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE), 
			'/',
			(SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE),
			'/',
			(SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE),
			'/',
			(SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL2 = CC.CODE)
			)
		)AS BUY_CAR_MDL2,
		(
			CONCAT(
			(SELECT CC.VALUE1 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE), 
			'/',
			(SELECT CC.VALUE3 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE),
			'/',
			(SELECT CC.VALUE4 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE),
			'/',
			(SELECT CC.VALUE5 FROM tbl_008_car_code CC WHERE BC.BUY_CAR_MDL3 = CC.CODE)
			)
		)AS BUY_CAR_MDL3,
		BC.BUY_CAR_PRICE1,
		BC.BUY_CAR_PRICE2,
		BC.BUY_CAR_OPEN_YM1,
		BC.BUY_CAR_OPEN_YM2,
		BC.BUY_CAR_MILEAGE1,
		BC.BUY_CAR_MILEAGE2,
		BC.BUY_CAR_TRSMS,
		BC.BUY_CAR_FUEL,
		BC.BUY_CAR_COLOR1,
		BC.BUY_CAR_COLOR2,
		BC.BUY_CAR_COLOR3,
		BC.BUY_CAR_USER_NAME,
		BC.BUY_CAR_USER_EMAIL,
		BC.BUY_CAR_USER_PHONE,
		BC.BUY_CAR_USER_ZIP,
		BC.BUY_CAR_USER_ADDR,
		BC.BUY_CAR_CHG_DATE
		FROM TBL_008_BUY_CAR BC
		WHERE BC.BUY_CAR_SEQ = #buyCarSeq#
		AND BC.BUY_CAR_USER_SEQ = #buyCarUserSeq#
	</select>
	
	<!-- 입력 수정 ~ 최신화 -->
	<update id="updateInput" parameterClass="RequestParameter">
		UPDATE TBL_008_BUY_CAR
		SET
			BUY_CAR_DEAL_TYPE = #buyCarDealType#,
			BUY_CAR_MDL1 = #buyCarMdlOne#,
			BUY_CAR_MDL2 = #buyCarMdlTwo#,
			BUY_CAR_MDL3 = #buyCarMdlThree#,
			BUY_CAR_PRICE1 = #buyCarPriceOne#,
			BUY_CAR_PRICE2 = #buyCarPriceTwo#,
			BUY_CAR_OPEN_YM1 = #buyCarOpenYmOne#,
			BUY_CAR_OPEN_YM2 = #buyCarOpenYmTwo#,
			BUY_CAR_MILEAGE1 = #buyCarMileageOne#,
			BUY_CAR_MILEAGE2 = #buyCarMileageTwo#,
			BUY_CAR_TRSMS = #buyCarTrsms#,
			BUY_CAR_FUEL = #buyCarFuel#,
			BUY_CAR_COLOR1 = #buyCarColorOne#,
			BUY_CAR_COLOR2 = #buyCarColorTwo#,
			BUY_CAR_COLOR3 = #buyCarColorThree#,
			BUY_CAR_USER_NAME = #buyCarUserName#,
			BUY_CAR_USER_EMAIL = #buyCarUserEmail#,
			BUY_CAR_USER_PHONE = #buyCarUserPhone#,
			BUY_CAR_USER_ZIP = #buyCarUserZip#,
			BUY_CAR_USER_ADDR = #buyCarUserAddr#,
			BUY_CAR_CHG_DATE = now()
		WHERE BUY_CAR_SEQ = #buyCarSeq#
		AND BUY_CAR_USER_SEQ = #buyCarUserSeq#
	</update>	
</sqlMap>

<!-- 
자동차 매매 ~ 희망자동차 진행현황 ~ 리스트 출력을 위한 쿼리문
SELECT
	IFNULL(BUY_CAR_SEQ, 0) AS BUY_CAR_SEQ,
	IFNULL(BUY_CAR_USER_SEQ, 0) AS BUY_CAR_USER_SEQ,
	BUY_CAR_REG_NO,
	BUY_CAR_DEAL_TYPE,
	CONCAT(
		(SELECT VALUE3 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL1),
		'/',
		(SELECT VALUE4 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL1)
	)AS BUY_CAR_MDL1,
	CONCAT(
		(SELECT VALUE3 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL2), 
		'/',
		(SELECT VALUE4 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL2)
	)AS BUY_CAR_MDL2,
	CONCAT(
		(SELECT VALUE3 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL3), 
		'/',
		(SELECT VALUE4 FROM TBL_008_CAR_CODE CC WHERE CC.CODE = BC.BUY_CAR_MDL3)
	)AS BUY_CAR_MDL3
	IFNULL(BUY_CAR_PRICE1, 0) AS BUY_CAR_PRICE1,
	IFNULL(BUY_CAR_PRICE2, 0) AS BUY_CAR_PRICE2,
	BUY_CAR_OPEN_YM1,
	BUY_CAR_OPEN_YM2,
	IFNULL(BUY_CAR_MILEAGE1, 0) AS BUY_CAR_MILEAGE1,
	IFNULL(BUY_CAR_MILEAGE2, 0) AS BUY_CAR_MILEAGE2,
	(SELECT VALUE1 
	FROM TBL_008_CODE CD
	WHERE CD.CODE_CATEGORY = 'CD_CAR_GEARSHIFT' 
	AND CD.CODE_KEY = BC.BUY_CAR_TRSMS)
	AS BUY_CAR_TRSMS,
	(SELECT VALUE1 
	FROM TBL_008_CODE CD
	WHERE CD.CODE_CATEGORY = 'CD_CAR_FUEL' 
	AND CD.CODE_KEY = BC.BUY_CAR_FUEL) 
	AS BUY_CAR_FUEL,
	(SELECT VALUE1 
	FROM TBL_008_CODE CD 
	WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
	AND CD.CODE_KEY = BC.BUY_CAR_COLOR1) 
	AS BUY_CAR_COLOR1,
	(SELECT VALUE1 
	FROM TBL_008_CODE CD 
	WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
	AND CD.CODE_KEY = BC.BUY_CAR_COLOR2) 
	AS BUY_CAR_COLOR2,
	(SELECT VALUE1 
	FROM TBL_008_CODE CD 
	WHERE CD.CODE_CATEGORY = 'CD_CAR_COLOR' 
	AND CD.CODE_KEY = BC.BUY_CAR_COLOR3) 
	AS BUY_CAR_COLOR3,
	BUY_CAR_USER_NAME,
	BUY_CAR_USER_EMAIL,
	BUY_CAR_USER_PHONE,
	BUY_CAR_USER_ZIP,
	BUY_CAR_USER_ADDR,
	BUY_CAR_STEP,
	DATE_FORMAT(BUY_CAR_REG_DATE, '%y/%m/%d') AS BUY_CAR_REG_DATE,
	BUY_CAR_CHG_DATE,
	BUY_CAR_MEMO,
	BUY_CAR_STATE_YN
FROM TBL_008_BUY_CAR BC
WHERE BUY_CAR_USER_SEQ = 8
ORDER BY BUY_CAR_SEQ DESC
 -->